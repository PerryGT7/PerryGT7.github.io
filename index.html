<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perry B. Johnson, PhD | Medical Physicist</title>
  <style>
    :root {
      --navy:   #003366;
      --teal:   #006699;
      --accent: #0099cc;
      --light:  #f4f7fb;
      --border: #d0dce8;
      --text:   #1a1a2e;
      --muted:  #5a6a7a;
      --white:  #ffffff;
      --radius: 8px;
      --shadow: 0 2px 12px rgba(0,51,102,0.10);
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Georgia', 'Times New Roman', serif;
      background: var(--light);
      color: var(--text);
      line-height: 1.7;
    }

    /* ── Header ───────────────────────────────────────────── */
    header {
      background:
        linear-gradient(rgba(0, 30, 60, 0.70), rgba(0, 60, 90, 0.75)),
        url('ufhpti.jpg') center / cover no-repeat;
      color: var(--white);
      padding: 60px 24px 48px;
      text-align: center;
    }

    .headshot {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      object-fit: cover;
      object-position: center 20%;
      border: 4px solid rgba(255,255,255,0.45);
      box-shadow: 0 6px 24px rgba(0,0,0,0.30);
      margin-bottom: 22px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    header h1 {
      font-size: clamp(2rem, 5vw, 3rem);
      font-weight: 700;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
    }

    header .subtitle {
      font-size: 1.1rem;
      font-style: italic;
      opacity: 0.88;
      margin-bottom: 6px;
    }

    header .institution {
      font-size: 1rem;
      opacity: 0.78;
      margin-bottom: 24px;
    }

    .header-links {
      display: flex;
      justify-content: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .header-links a {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.35);
      color: var(--white);
      text-decoration: none;
      padding: 7px 16px;
      border-radius: 24px;
      font-size: 0.88rem;
      font-family: 'Arial', sans-serif;
      transition: background 0.2s;
    }

    .header-links a:hover { background: rgba(255,255,255,0.28); }

    /* ── Nav ──────────────────────────────────────────────── */
    nav {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--navy);
      display: flex;
      justify-content: center;
      gap: 4px;
      padding: 0 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.25);
    }

    nav a {
      color: rgba(255,255,255,0.80);
      text-decoration: none;
      padding: 14px 20px;
      font-family: 'Arial', sans-serif;
      font-size: 0.88rem;
      font-weight: 600;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      transition: color 0.2s, border-bottom 0.2s;
      border-bottom: 3px solid transparent;
    }

    nav a:hover, nav a.active {
      color: var(--white);
      border-bottom-color: var(--accent);
    }

    /* ── Main layout ──────────────────────────────────────── */
    main {
      max-width: 960px;
      margin: 0 auto;
      padding: 48px 24px 80px;
    }

    section { margin-bottom: 60px; }

    .section-title {
      font-size: 1.6rem;
      color: var(--navy);
      border-bottom: 3px solid var(--accent);
      padding-bottom: 10px;
      margin-bottom: 28px;
      font-weight: 700;
    }

    /* ── About ────────────────────────────────────────────── */
    .about-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 28px;
    }

    @media (max-width: 640px) { .about-grid { grid-template-columns: 1fr; } }

    .about-card {
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px 28px;
      box-shadow: var(--shadow);
    }

    .about-card h3 {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: var(--accent);
      font-family: 'Arial', sans-serif;
      font-weight: 700;
      margin-bottom: 14px;
    }

    .about-card p {
      font-size: 0.97rem;
      color: var(--text);
      margin-bottom: 10px;
    }

    .about-card ul {
      list-style: none;
      padding: 0;
    }

    .about-card ul li {
      font-size: 0.95rem;
      color: var(--text);
      padding: 4px 0;
      padding-left: 16px;
      position: relative;
    }

    .about-card ul li::before {
      content: '▸';
      position: absolute;
      left: 0;
      color: var(--accent);
      font-size: 0.85rem;
    }

    .bio-full {
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 28px 32px;
      box-shadow: var(--shadow);
      margin-bottom: 28px;
      font-size: 0.98rem;
    }

    /* ── Publication controls ─────────────────────────────── */
    .pub-controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 28px;
    }

    #pub-search {
      flex: 1;
      min-width: 220px;
      padding: 10px 16px;
      border: 1.5px solid var(--border);
      border-radius: 24px;
      font-size: 0.95rem;
      font-family: 'Arial', sans-serif;
      color: var(--text);
      background: var(--white);
      outline: none;
      transition: border-color 0.2s;
    }

    #pub-search:focus { border-color: var(--accent); }

    .filter-btns { display: flex; gap: 8px; flex-wrap: wrap; }

    .filter-btn {
      padding: 7px 16px;
      border: 1.5px solid var(--border);
      border-radius: 20px;
      background: var(--white);
      font-size: 0.82rem;
      font-family: 'Arial', sans-serif;
      font-weight: 600;
      color: var(--muted);
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-btn:hover { border-color: var(--accent); color: var(--accent); }
    .filter-btn.active { background: var(--navy); border-color: var(--navy); color: var(--white); }

    .pub-count {
      font-family: 'Arial', sans-serif;
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 20px;
    }

    /* ── Year groups ──────────────────────────────────────── */
    .year-group { margin-bottom: 36px; }

    .year-label {
      font-size: 1.1rem;
      font-weight: 700;
      font-family: 'Arial', sans-serif;
      color: var(--teal);
      margin-bottom: 14px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .year-label::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    /* ── Publication card ─────────────────────────────────── */
    .pub-card {
      background: var(--white);
      border: 1px solid var(--border);
      border-left: 4px solid var(--accent);
      border-radius: var(--radius);
      padding: 18px 22px;
      margin-bottom: 14px;
      box-shadow: var(--shadow);
      transition: box-shadow 0.2s, border-left-color 0.2s;
    }

    .pub-card:hover {
      box-shadow: 0 4px 20px rgba(0,51,102,0.15);
      border-left-color: var(--navy);
    }

    .pub-card.hidden { display: none; }

    .pub-title {
      font-size: 1rem;
      font-weight: 700;
      color: var(--navy);
      margin-bottom: 6px;
      line-height: 1.4;
    }

    .pub-title a {
      color: inherit;
      text-decoration: none;
    }

    .pub-title a:hover { text-decoration: underline; color: var(--teal); }

    .pub-authors {
      font-size: 0.88rem;
      color: var(--muted);
      margin-bottom: 4px;
      font-family: 'Arial', sans-serif;
    }

    .pub-authors strong {
      color: var(--navy);
      font-weight: 700;
    }

    .pub-journal {
      font-size: 0.88rem;
      font-style: italic;
      color: var(--text);
      font-family: 'Arial', sans-serif;
    }

    .pub-meta {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .pub-badge {
      display: inline-block;
      font-size: 0.75rem;
      font-family: 'Arial', sans-serif;
      font-weight: 600;
      padding: 2px 10px;
      border-radius: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge-proton  { background: #e0f0f8; color: #005580; }
    .badge-mr      { background: #e8f5e9; color: #2e7d32; }
    .badge-safety  { background: #fff3e0; color: #e65100; }
    .badge-dosimetry { background: #f3e5f5; color: #6a1b9a; }
    .badge-imaging { background: #e8eaf6; color: #283593; }

    .pub-pmid a {
      font-size: 0.78rem;
      font-family: 'Arial', sans-serif;
      color: var(--accent);
      text-decoration: none;
    }
    .pub-pmid a:hover { text-decoration: underline; }

    /* ── No results ────────────────────────────────────────── */
    #no-results {
      display: none;
      text-align: center;
      padding: 48px;
      color: var(--muted);
      font-family: 'Arial', sans-serif;
    }

    /* ── Game ─────────────────────────────────────────────── */
    .game-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 18px;
    }

    #cyclotronCanvas {
      display: block;
      background: #020d1a;
      border: 2px solid var(--border);
      border-radius: var(--radius);
      box-shadow: 0 4px 24px rgba(0,51,102,0.22);
      max-width: 100%;
      cursor: default;
    }

    .game-meta {
      font-family: 'Arial', sans-serif;
      font-size: 0.82rem;
      color: var(--muted);
      text-align: center;
      max-width: 480px;
    }

    .game-meta kbd {
      display: inline-block;
      background: var(--navy);
      color: #fff;
      border-radius: 4px;
      padding: 1px 7px;
      font-size: 0.82rem;
      font-family: monospace;
    }

    /* ── Footer ───────────────────────────────────────────── */
    footer {
      background: var(--navy);
      color: rgba(255,255,255,0.65);
      text-align: center;
      padding: 28px 24px;
      font-family: 'Arial', sans-serif;
      font-size: 0.82rem;
    }

    footer a { color: rgba(255,255,255,0.80); text-decoration: none; }
    footer a:hover { color: var(--white); }
  </style>
</head>
<body>

<!-- ══ HEADER ══════════════════════════════════════════════ -->
<header>
  <img src="headshot.jpg" alt="Perry B. Johnson, PhD" class="headshot" />
  <h1>Perry B. Johnson, PhD</h1>
  <p class="subtitle">Professor &amp; Director of Physics</p>
  <p class="institution">Department of Radiation Oncology, University of Florida &mdash; UF Health Proton Therapy Institute</p>
  <div class="header-links">
    <a href="https://scholar.google.com/citations?user=S6bc8o8AAAAJ&hl=en" target="_blank" rel="noopener">
      &#127891; Google Scholar
    </a>
    <a href="https://www.researchgate.net/profile/Perry-Johnson-4" target="_blank" rel="noopener">
      &#128196; ResearchGate
    </a>
    <a href="https://pubmed.ncbi.nlm.nih.gov/?term=Johnson+PB%5BAuthor%5D&sort=date" target="_blank" rel="noopener">
      &#128209; PubMed
    </a>
    <a href="https://www.floridaproton.org/about-us/physicians-staff/perry-johnson-phd" target="_blank" rel="noopener">
      &#127973; UFHPTI Profile
    </a>
  </div>
</header>

<!-- ══ NAV ═════════════════════════════════════════════════ -->
<nav>
  <a href="#about">About</a>
  <a href="#publications">Publications</a>
  <a href="#game">Cyclotron Game</a>
</nav>

<!-- ══ MAIN ════════════════════════════════════════════════ -->
<main>

  <!-- About -->
  <section id="about">
    <h2 class="section-title">About</h2>

    <div class="bio-full">
      <p>
        Dr. Perry B. Johnson is a Professor and the Director of Physics at the
        <strong>UF Health Proton Therapy Institute</strong> in Jacksonville, Florida, within the
        Department of Radiation Oncology at the University of Florida College of Medicine.
        He received his PhD from the University of Florida and completed his residency training
        at MD Anderson Cancer Center (Orlando). He holds undergraduate and graduate degrees
        from the Georgia Institute of Technology.
      </p>
      <br />
      <p>
        Dr. Johnson's research spans several areas of medical physics, including
        <strong>mixed-reality visualization for patient setup and radiotherapy</strong>,
        proton therapy treatment planning and quality assurance, patient safety and error
        prevention, radiation dosimetry, and quantitative imaging. He serves as an
        <strong>Associate Editor</strong> for the <em>International Journal of Particle Therapy</em>
        and is a principal or co-investigator on grants and clinical trials totaling over
        $13 million in award support.
      </p>
    </div>

    <div class="about-grid">
      <div class="about-card">
        <h3>Education &amp; Training</h3>
        <ul>
          <li>PhD &mdash; University of Florida</li>
          <li>MS &mdash; Georgia Institute of Technology</li>
          <li>BS &mdash; Georgia Institute of Technology</li>
          <li>Residency &mdash; MD Anderson Cancer Center, Orlando</li>
        </ul>
      </div>
      <div class="about-card">
        <h3>Research Interests</h3>
        <ul>
          <li>Mixed-reality visualization in radiation oncology</li>
          <li>Proton therapy planning &amp; quality assurance</li>
          <li>Patient safety &amp; error prevention</li>
          <li>Radiation dosimetry &amp; phantom modeling</li>
          <li>Quantitative PET/CT imaging</li>
          <li>Gamma Knife radiosurgery optimization</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Publications -->
  <section id="publications">
    <h2 class="section-title">Publications</h2>

    <div class="pub-controls">
      <input type="text" id="pub-search" placeholder="Search by title, author, or journal&hellip;" aria-label="Search publications" />
      <div class="filter-btns">
        <button class="filter-btn active" data-topic="all">All</button>
        <button class="filter-btn" data-topic="proton">Proton Therapy</button>
        <button class="filter-btn" data-topic="mr">Mixed Reality</button>
        <button class="filter-btn" data-topic="safety">Safety</button>
        <button class="filter-btn" data-topic="dosimetry">Dosimetry</button>
        <button class="filter-btn" data-topic="imaging">Imaging</button>
      </div>
    </div>

    <p class="pub-count" id="pub-count"></p>
    <div id="pub-list"></div>
    <div id="no-results">No publications match your search.</div>
  </section>

  <!-- Game -->
  <section id="game">
    <h2 class="section-title">Cyclotron Game</h2>
    <div class="game-wrap">
      <canvas id="cyclotronCanvas" width="480" height="480"></canvas>
      <p class="game-meta">
        Press <kbd>Space</kbd> to start &mdash; then press <kbd>Space</kbd> each time the proton crosses
        the gap between the dees to accelerate it. Extract the beam before you run out of boosts!
      </p>
    </div>
  </section>

</main>

<!-- ══ FOOTER ══════════════════════════════════════════════ -->
<footer>
  <p>Perry B. Johnson, PhD &nbsp;&bull;&nbsp;
    <a href="https://www.floridaproton.org" target="_blank" rel="noopener">UF Health Proton Therapy Institute</a>
    &nbsp;&bull;&nbsp; Jacksonville, FL
  </p>
</footer>

<!-- ══ DATA &amp; LOGIC ════════════════════════════════════ -->
<script>
  const publications = [
    // ── 2026 ──────────────────────────────────────────────
    {
      year: 2026,
      title: "Management of a Multi-Room Downtime Event in a Multi-System Environment: A Case Report in Proton Therapy Operations",
      authors: "<strong>Johnson PB</strong>, Robbert B, Fleming T, Dillinger T, Kirby K, Heath K, Mendenhall NP",
      journal: "Int J Part Ther. 2026;19:101306",
      url: "https://doi.org/10.1016/j.ijpt.2026.101306",
      topics: ["proton", "safety"]
    },
    {
      year: 2026,
      title: "Radiation-Induced Acute Lung Pneumonitis After Pencil-Beam Scanning Proton Treatment for Breast Cancer: Correlation With Dose-Volume Parameters and Optimization Objectives to Reduce Lung Toxicities",
      authors: "Park J, Bradley JA, Mendenhall NP, Mailhot Vega RB, Burchianti T, Zhang Y, Grewal H, Saki M, Willoughby T, <strong>Johnson PB</strong>, Artz M",
      journal: "Pract Radiat Oncol. 2026;16(1):8–14",
      pmid: "40840709",
      topics: ["proton"]
    },
    {
      year: 2026,
      title: "Combining Statins with Radiotherapy for Prostate Cancer: From Photon Experience to Proton Potential",
      authors: "Saki M, Artz ME, Park J, <strong>Johnson PB</strong>, Bryant C, Balaji KC, Grewal H",
      journal: "J Clin Med. 2026;15(2):568",
      pmid: "41598506",
      topics: ["proton"]
    },
    // ── 2025 ──────────────────────────────────────────────
    {
      year: 2025,
      title: "Three-Dimensional Surface Scanning of Patients to Extend Computed Tomography Field of View and Scan Length for Dose Calculation and Collision Avoidance in Radiotherapy Treatment Planning",
      authors: "Jackson AM, Shrestha DK, <strong>Johnson PB</strong>",
      journal: "J Appl Clin Med Phys. 2025;26(11):e70333",
      pmid: "41215563",
      topics: ["dosimetry"]
    },
    {
      year: 2025,
      title: "Bridging the Proton Gap: A Proton Therapy Consultation Service for Canadian Radiation Oncologists",
      authors: "Kim I, Parent A, Holwell M, Craig T, Lindsay P, Le H, Tsang Y, <strong>Johnson PB</strong>, Indelicato DJ, Liu FF, Tsang DS",
      journal: "Tech Innov Patient Support Radiat Oncol. 2025;35:100320",
      pmid: "40585858",
      topics: ["proton"]
    },
    {
      year: 2025,
      title: "RBE-Guided Treatment Planning, LET Optimization, and Implications of Proton Arc Therapy for the Sparing of Nervous Tissue in Head and Neck Proton Therapy",
      authors: "Reiners K, Artz M, Bryant CM, Dagan R, Grewal HS, <strong>Johnson PB</strong>, Li Z, Park J, Vieceli M, Zhang Y",
      journal: "Cancers (Basel). 2025;17(23):3724",
      pmid: "41374925",
      topics: ["proton"]
    },
    {
      year: 2025,
      title: "Operational Improvement of a Proton Therapy System From Reduced Energy Layer Switching Time",
      authors: "Artz ME, Grewal HS, Zhang Y, <strong>Johnson PB</strong>, Saki M, Schreuder N, Brooks ED, Park J",
      journal: "Int J Part Ther. 2025;16:100742",
      pmid: "40165884",
      topics: ["proton"]
    },
    // ── 2024 ──────────────────────────────────────────────
    {
      year: 2024,
      title: "First-in-Human Trial Using Mixed-Reality Visualization for Patient Setup During Breast or Chest Wall Radiotherapy",
      authors: "<strong>Johnson PB</strong>, Bradley J, Lampotang S, Jackson A, Lizdas D, Johnson W, Brooks E, Vega RBM, Mendenhall N",
      journal: "Radiat Oncol. 2024;19(1):163",
      pmid: "39558366",
      topics: ["mr"]
    },
    {
      year: 2024,
      title: "Secondary Cancer Risk in Six Anatomical Sites When Using PAT, IMPT, and VMAT/IMRT Radiotherapy",
      authors: "<strong>Johnson PB</strong>, Mamalui M, Brodin P, Janssens G",
      journal: "Radiother Oncol. 2024;199:110421",
      pmid: "38997093",
      topics: ["proton", "dosimetry"]
    },
    {
      year: 2024,
      title: "AAPM WGPE Report 394: Simulated Error Training for the Physics Plan and Chart Review",
      authors: "<strong>Johnson PB</strong>, Schubert L, Kim GG, Faught J, Buckey C, Conroy L, Luk SMH, Schofield D, Parker S",
      journal: "Med Phys. 2024;51(5):3165–3172",
      pmid: "38588484",
      topics: ["safety"]
    },
    // ── 2022 ──────────────────────────────────────────────
    {
      year: 2022,
      title: "Patient Posture Correction and Alignment Using Mixed Reality Visualization and the HoloLens 2",
      authors: "<strong>Johnson PB</strong>, Jackson A, Saki M, Feldman E, Bradley J",
      journal: "Med Phys. 2022;49(1):15–22",
      pmid: "34780068",
      topics: ["mr"]
    },
    // ── 2021 ──────────────────────────────────────────────
    {
      year: 2021,
      title: "Effective Organs-at-Risk Dose Sparing in Volumetric Modulated Arc Therapy Using a Half-Beam Technique in Whole Pelvic Irradiation",
      authors: "Jang H, Park J, Artz M, Zhang Y, Ricci JC, Huh S, <strong>Johnson PB</strong>, Kim MH, Chun M, Oh YT, Noh OK, Park HJ",
      journal: "Front Oncol. 2021;11:611469",
      pmid: "34490075",
      topics: ["dosimetry"]
    },
    // ── 2019 ──────────────────────────────────────────────
    {
      year: 2019,
      title: "Clinical Evaluation of Shot-Within-Shot Optimization for Gamma Knife Radiosurgery Planning and Delivery",
      authors: "<strong>Johnson PB</strong>, Monterroso MI, Yang F, Bossart E, Keyvanloo A, Mellon EA",
      journal: "World Neurosurg. 2019;123:e218–e227",
      pmid: "30481630",
      topics: ["dosimetry"]
    },
    // ── 2018 ──────────────────────────────────────────────
    {
      year: 2018,
      title: "Data for Optimizing Gamma Knife Radiosurgery Using the Shot Within Shot Technique",
      authors: "<strong>Johnson PB</strong>, Monterroso MI, Yang F, Bossart E, Keyvanloo A, Mellon EA",
      journal: "Data Brief. 2018;22:620–626",
      pmid: "30671508",
      topics: ["dosimetry"]
    },
    {
      year: 2018,
      title: "Quantitative Radiomics: Validating Image Textural Features for Oncological PET in Lung Cancer",
      authors: "Yang F, Young LA, <strong>Johnson PB</strong>",
      journal: "Radiother Oncol. 2018;129(2):209–217",
      pmid: "30279049",
      topics: ["imaging"]
    },
    // ── 2017 ──────────────────────────────────────────────
    {
      year: 2017,
      title: "Optimization of the Prescription Isodose Line for Gamma Knife Radiosurgery Using the Shot Within Shot Technique",
      authors: "<strong>Johnson PB</strong>, Monterroso MI, Yang F, Mellon E",
      journal: "Radiat Oncol. 2017;12(1):187",
      pmid: "29178912",
      topics: ["dosimetry"]
    },
    {
      year: 2017,
      title: "Quantitative Imaging: Correlating Image Features With the Segmentation Accuracy of PET-Based Tumor Contours in the Lung",
      authors: "<strong>Johnson PB</strong>, Young LA, Lamichhane N, Patel V, Chinea FM, Yang F",
      journal: "Radiother Oncol. 2017;123(2):257–262",
      pmid: "28433412",
      topics: ["imaging"]
    },
    // ── 2016 ──────────────────────────────────────────────
    {
      year: 2016,
      title: "Evaluation of the Tool &ldquo;Reg Refine&rdquo; for User-Guided Deformable Image Registration",
      authors: "<strong>Johnson PB</strong>, Padgett KR, Chen KL, Dogan N",
      journal: "J Appl Clin Med Phys. 2016;17(3):158–170",
      pmid: "27167273",
      topics: ["imaging"]
    },
    {
      year: 2016,
      title: "An Image Guided Small Animal Stereotactic Radiotherapy System",
      authors: "Sha H, Udayakumar TS, <strong>Johnson PB</strong>, Dogan N, Pollack A, Yang Y",
      journal: "Oncotarget. 2016;7(14):18825–18836",
      pmid: "26958942",
      topics: ["imaging", "dosimetry"]
    },
    // ── 2011 ──────────────────────────────────────────────
    {
      year: 2011,
      title: "Skin Dose Mapping for Fluoroscopically Guided Interventions",
      authors: "<strong>Johnson PB</strong>, Borrego D, Balter S, Johnson K, Siragusa D, Bolch WE",
      journal: "Med Phys. 2011;38(10):5490–5499",
      pmid: "21992367",
      topics: ["dosimetry", "safety"]
    },
    {
      year: 2011,
      title: "The Impact of Anthropometric Patient-Phantom Matching on Organ Dose: A Hybrid Phantom Study for Fluoroscopy Guided Interventions",
      authors: "<strong>Johnson PB</strong>, Geyer A, Borrego D, Ficarrotta K, Johnson K, Bolch WE",
      journal: "Med Phys. 2011;38(2):1008–1017",
      pmid: "21452738",
      topics: ["dosimetry"]
    },
    {
      year: 2011,
      title: "Response Functions for Computing Absorbed Dose to Skeletal Tissues from Photon Irradiation &mdash; An Update",
      authors: "<strong>Johnson PB</strong>, Bahadori AA, Eckerman KF, Lee C, Bolch WE",
      journal: "Phys Med Biol. 2011;56(8):2347–2365",
      pmid: "21427484",
      topics: ["dosimetry"]
    }
  ];

  /* Badge config */
  const topicMeta = {
    proton:    { label: "Proton Therapy",  cls: "badge-proton"   },
    mr:        { label: "Mixed Reality",   cls: "badge-mr"       },
    safety:    { label: "Patient Safety",  cls: "badge-safety"   },
    dosimetry: { label: "Dosimetry",       cls: "badge-dosimetry"},
    imaging:   { label: "Imaging",         cls: "badge-imaging"  }
  };

  /* ── Render ─────────────────────────────────────────────── */
  function render(pubs) {
    const container = document.getElementById("pub-list");
    const noRes     = document.getElementById("no-results");
    const countEl   = document.getElementById("pub-count");

    if (pubs.length === 0) {
      container.innerHTML = "";
      noRes.style.display = "block";
      countEl.textContent = "";
      return;
    }
    noRes.style.display = "none";
    countEl.textContent = `Showing ${pubs.length} of ${publications.length} publications`;

    // Group by year
    const byYear = {};
    pubs.forEach(p => {
      if (!byYear[p.year]) byYear[p.year] = [];
      byYear[p.year].push(p);
    });

    const years = Object.keys(byYear).sort((a, b) => b - a);
    container.innerHTML = years.map(yr => `
      <div class="year-group">
        <div class="year-label">${yr}</div>
        ${byYear[yr].map(p => pubCard(p)).join("")}
      </div>
    `).join("");
  }

  function pubCard(p) {
    const badges = p.topics.map(t => {
      const m = topicMeta[t];
      return `<span class="pub-badge ${m.cls}">${m.label}</span>`;
    }).join(" ");

    const href = p.pmid
      ? `https://pubmed.ncbi.nlm.nih.gov/${p.pmid}/`
      : (p.url || null);

    const extLink = p.pmid
      ? `<span class="pub-pmid"><a href="https://pubmed.ncbi.nlm.nih.gov/${p.pmid}/" target="_blank" rel="noopener">PubMed &#8599;</a></span>`
      : p.url
        ? `<span class="pub-pmid"><a href="${p.url}" target="_blank" rel="noopener">DOI &#8599;</a></span>`
        : "";

    return `
      <div class="pub-card" data-topics="${p.topics.join(" ")}">
        <div class="pub-title">
          ${href
            ? `<a href="${href}" target="_blank" rel="noopener">${p.title}</a>`
            : p.title}
        </div>
        <div class="pub-authors">${p.authors}</div>
        <div class="pub-journal">${p.journal}</div>
        <div class="pub-meta">
          ${badges}
          ${extLink}
        </div>
      </div>
    `;
  }

  /* ── Filter logic ────────────────────────────────────────── */
  let activeTopic = "all";
  let searchQuery = "";

  function filtered() {
    return publications.filter(p => {
      const matchTopic  = activeTopic === "all" || p.topics.includes(activeTopic);
      const q = searchQuery.toLowerCase();
      const matchSearch = !q ||
        p.title.toLowerCase().includes(q) ||
        p.authors.replace(/<[^>]+>/g, "").toLowerCase().includes(q) ||
        p.journal.toLowerCase().includes(q) ||
        String(p.year).includes(q);
      return matchTopic && matchSearch;
    });
  }

  document.querySelectorAll(".filter-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      activeTopic = btn.dataset.topic;
      render(filtered());
    });
  });

  document.getElementById("pub-search").addEventListener("input", e => {
    searchQuery = e.target.value;
    render(filtered());
  });

  /* ── Active nav highlight on scroll ─────────────────────── */
  const sections = document.querySelectorAll("main section[id]");
  const navLinks = document.querySelectorAll("nav a");

  window.addEventListener("scroll", () => {
    let current = "";
    sections.forEach(s => {
      if (window.scrollY >= s.offsetTop - 80) current = s.id;
    });
    navLinks.forEach(a => {
      a.classList.toggle("active", a.getAttribute("href") === "#" + current);
    });
  });

  /* ── Init ───────────────────────────────────────────────── */
  render(filtered());

  /* ══════════════════════════════════════════════════════════
     CYCLOTRON MINIGAME
  ══════════════════════════════════════════════════════════ */
  (function () {
    const canvas = document.getElementById('cyclotronCanvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const W = 480, H = 480, cx = W / 2, cy = H / 2;
    const MAX_R = 195, MIN_R = 24, GAP_HALF = 8;
    const BOOSTS_NEEDED = 10, MAX_MISSES = 3;
    const GAP_ZONE = 0.22; // radians window around each gap crossing

    let state = 'idle'; // idle | playing | win | gameover
    let theta = 0, radius = MIN_R, speed = 0.026;
    let boosts = 0, misses = 0;
    let gapFlash = 0, missFlash = 0, winPulse = 0;
    let particles = [];

    const energy = () => Math.round((boosts / BOOSTS_NEEDED) * 100);
    const inGap  = () => { const a = theta % Math.PI; return a < GAP_ZONE || a > Math.PI - GAP_ZONE; };
    const pPos   = () => ({ x: cx + radius * Math.cos(theta), y: cy + radius * Math.sin(theta) });

    function reset() {
      theta = 0; radius = MIN_R; speed = 0.026;
      boosts = 0; misses = 0;
      gapFlash = 0; missFlash = 0; winPulse = 0; particles = [];
    }

    /* ── Drawing helpers ── */
    function drawDees() {
      // Right dee
      ctx.beginPath();
      ctx.moveTo(cx + GAP_HALF, cy - MAX_R);
      ctx.arc(cx, cy, MAX_R, -Math.PI / 2, Math.PI / 2);
      ctx.lineTo(cx + GAP_HALF, cy + MAX_R);
      ctx.closePath();
      ctx.fillStyle = 'rgba(0,100,160,0.18)';
      ctx.fill();
      ctx.strokeStyle = 'rgba(0,160,220,0.55)'; ctx.lineWidth = 2; ctx.stroke();

      // Left dee
      ctx.beginPath();
      ctx.moveTo(cx - GAP_HALF, cy - MAX_R);
      ctx.arc(cx, cy, MAX_R, -Math.PI / 2, Math.PI / 2, true);
      ctx.lineTo(cx - GAP_HALF, cy + MAX_R);
      ctx.closePath();
      ctx.fillStyle = 'rgba(0,60,120,0.18)';
      ctx.fill();
      ctx.strokeStyle = 'rgba(0,120,190,0.55)'; ctx.lineWidth = 2; ctx.stroke();

      // Gap glow when proton is near
      if (state === 'playing' && inGap()) {
        const a = 0.12 + 0.12 * Math.sin(Date.now() / 80);
        ctx.fillStyle = `rgba(0,220,255,${a})`;
        ctx.fillRect(cx - GAP_HALF - 2, cy - MAX_R, (GAP_HALF + 2) * 2, MAX_R * 2);
      }
    }

    function drawOrbits() {
      const step = (MAX_R - MIN_R) / BOOSTS_NEEDED;
      ctx.save();
      ctx.setLineDash([4, 8]);
      for (let i = 0; i <= BOOSTS_NEEDED; i++) {
        ctx.beginPath();
        ctx.arc(cx, cy, MIN_R + i * step, 0, Math.PI * 2);
        ctx.strokeStyle = i <= boosts ? 'rgba(0,190,230,0.22)' : 'rgba(80,130,170,0.08)';
        ctx.lineWidth = 1; ctx.stroke();
      }
      ctx.setLineDash([]); ctx.restore();
    }

    function drawProton() {
      const { x, y } = pPos();
      const g = ctx.createRadialGradient(x, y, 0, x, y, 18);
      g.addColorStop(0, 'rgba(0,240,255,0.85)');
      g.addColorStop(0.5, 'rgba(0,160,255,0.35)');
      g.addColorStop(1, 'rgba(0,100,200,0)');
      ctx.beginPath(); ctx.arc(x, y, 18, 0, Math.PI * 2);
      ctx.fillStyle = g; ctx.fill();
      ctx.beginPath(); ctx.arc(x, y, 5, 0, Math.PI * 2);
      ctx.fillStyle = '#fff';
      ctx.shadowColor = '#00eeff'; ctx.shadowBlur = 14;
      ctx.fill(); ctx.shadowBlur = 0;
    }

    function drawParticles() {
      particles = particles.filter(p => p.life > 0);
      particles.forEach(p => {
        ctx.save(); ctx.globalAlpha = p.life / p.maxLife;
        ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        ctx.fillStyle = p.color; ctx.fill(); ctx.restore();
        p.x += p.vx; p.y += p.vy; p.life--; p.r *= 0.94;
      });
    }

    function spawnParticles() {
      const { x, y } = pPos();
      for (let i = 0; i < 18; i++) {
        const a = Math.random() * Math.PI * 2, s = 1.5 + Math.random() * 3;
        particles.push({ x, y, vx: Math.cos(a) * s, vy: Math.sin(a) * s,
          r: 3 + Math.random() * 3, life: 30, maxLife: 30,
          color: `hsl(${185 + Math.random() * 35},100%,70%)` });
      }
    }

    function drawHUD() {
      const bx = 20, by = H - 42, bw = W - 40, bh = 16;
      ctx.fillStyle = 'rgba(0,15,35,0.75)';
      ctx.beginPath(); ctx.roundRect(bx, by, bw, bh, 8); ctx.fill();
      const g = ctx.createLinearGradient(bx, 0, bx + bw, 0);
      g.addColorStop(0, '#006fa8'); g.addColorStop(1, '#00eeff');
      ctx.fillStyle = g;
      ctx.beginPath(); ctx.roundRect(bx, by, bw * energy() / 100, bh, 8); ctx.fill();
      ctx.fillStyle = '#fff'; ctx.font = 'bold 11px Arial,sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText(`BEAM ENERGY  ${energy()}%`, W / 2, by - 7);
      ctx.textAlign = 'left';  ctx.font = '12px Arial,sans-serif';
      ctx.fillStyle = 'rgba(255,255,255,0.75)';
      ctx.fillText(`Boosts: ${boosts}`, 20, 26);
      ctx.textAlign = 'right';
      ctx.fillStyle = misses > 0 ? '#ff7777' : 'rgba(255,255,255,0.75)';
      ctx.fillText(`Misses: ${misses} / ${MAX_MISSES}`, W - 20, 26);
    }

    function drawPrompt() {
      if (!inGap()) return;
      const a = 0.65 + 0.35 * Math.sin(Date.now() / 110);
      ctx.save(); ctx.globalAlpha = a;
      ctx.fillStyle = '#00eeff'; ctx.font = 'bold 15px Arial,sans-serif';
      ctx.textAlign = 'center'; ctx.shadowColor = '#00eeff'; ctx.shadowBlur = 10;
      ctx.fillText('▼  PRESS SPACE TO BOOST!  ▼', cx, cy - MAX_R - 14);
      ctx.restore();
    }

    function drawFlashes() {
      if (gapFlash > 0) {
        ctx.save(); ctx.globalAlpha = gapFlash / 16;
        ctx.fillStyle = '#00ffdd';
        ctx.fillRect(cx - GAP_HALF - 10, cy - MAX_R, (GAP_HALF + 10) * 2, MAX_R * 2);
        ctx.restore(); gapFlash--;
      }
      if (missFlash > 0) {
        ctx.save(); ctx.globalAlpha = (missFlash / 18) * 0.45;
        ctx.fillStyle = '#ff2222'; ctx.fillRect(0, 0, W, H);
        ctx.restore(); missFlash--;
      }
    }

    function overlay(bg, title, titleColor, lines, cta) {
      ctx.save(); ctx.globalAlpha = 0.88;
      ctx.fillStyle = bg; ctx.fillRect(0, 0, W, H);
      ctx.restore();
      ctx.textAlign = 'center';
      ctx.fillStyle = titleColor; ctx.font = 'bold 26px Arial,sans-serif';
      ctx.shadowColor = titleColor; ctx.shadowBlur = 18;
      ctx.fillText(title, cx, cy - 54); ctx.shadowBlur = 0;
      ctx.fillStyle = '#fff'; ctx.font = '14px Arial,sans-serif';
      lines.forEach((l, i) => ctx.fillText(l, cx, cy - 18 + i * 24));
      const p = 0.65 + 0.35 * Math.sin(Date.now() / 420);
      ctx.globalAlpha = p; ctx.fillStyle = '#00eeff';
      ctx.font = 'bold 13px Arial,sans-serif';
      ctx.fillText(cta, cx, cy + lines.length * 24 + 18);
      ctx.globalAlpha = 1;
    }

    /* ── Game loop ── */
    function loop() {
      ctx.clearRect(0, 0, W, H);

      if (state === 'idle') {
        drawDees();
        ctx.fillStyle = 'rgba(2,13,26,0.60)'; ctx.fillRect(0, 0, W, H);
        overlay('rgba(0,0,0,0)', 'CYCLOTRON', '#00eeff',
          ['Accelerate the proton to treatment energy!',
           `Press SPACE ${BOOSTS_NEEDED}× at the gap to extract the beam.`,
           `${MAX_MISSES} mistimed presses and the beam is lost.`],
          '— PRESS SPACE TO BEGIN —');
        requestAnimationFrame(loop); return;
      }

      if (state === 'win') {
        drawOrbits(); drawDees(); drawProton(); drawParticles();
        overlay('rgba(0,12,28,0.82)', 'BEAM EXTRACTED! ⚡', '#00eeff',
          ['Proton beam ready for treatment.',
           `Energy: 100%   Boosts: ${boosts}   Misses: ${misses}`],
          'Press SPACE to play again');
        winPulse++; requestAnimationFrame(loop); return;
      }

      if (state === 'gameover') {
        drawOrbits(); drawDees(); drawFlashes();
        overlay('rgba(24,0,0,0.88)', 'BEAM LOST', '#ff5555',
          ['Too many mistimed boosts.',
           `Reached ${energy()}% beam energy.`],
          'Press SPACE to try again');
        requestAnimationFrame(loop); return;
      }

      // Playing
      theta += speed;
      drawOrbits(); drawDees(); drawFlashes(); drawProton(); drawParticles(); drawPrompt(); drawHUD();
      requestAnimationFrame(loop);
    }

    /* ── Input ── */
    document.addEventListener('keydown', function (e) {
      if (e.code !== 'Space') return;
      // Only intercept when game section is roughly in view
      const rect = canvas.getBoundingClientRect();
      if (rect.bottom < 0 || rect.top > window.innerHeight * 2) return;
      e.preventDefault();

      if (state === 'idle' || state === 'win' || state === 'gameover') {
        reset(); state = 'playing'; return;
      }
      if (state !== 'playing') return;

      if (inGap()) {
        boosts++;
        radius = Math.min(MAX_R - 4, MIN_R + boosts * (MAX_R - MIN_R) / BOOSTS_NEEDED);
        speed  = 0.026 + boosts * 0.0018;
        gapFlash = 16; spawnParticles();
        if (boosts >= BOOSTS_NEEDED) state = 'win';
      } else {
        misses++; missFlash = 18;
        if (misses >= MAX_MISSES) state = 'gameover';
      }
    });

    loop();
  })();
</script>
</body>
</html>
